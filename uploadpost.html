<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="uploadpost.css">
<script src="postpage.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <style>
        [data-toggle="collapse"][aria-expanded="false"] > .js-rotate-if-collapsed
        {
            -webkit-transform:rotate(180deg);
  			-webkit-transition-duration: 1s;
        }

    </style>

	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
</head>

<body>

<script type="text/javascript">
	function descbuttonchange(descbutton) {

		descbutton.closest(".methodclass").querySelector("#metinput").value="";
	  var x = document.getElementById("adddesc");

	  if (x.innerHTML.includes("Remove")) { //includes check if it's add or remove
	    x.innerHTML = "<i class='fas fa-plus'></i> Add Description";
		//x.style.cssText  = "border-color: #0275d8;";
		descbutton.closest(".methodclass").querySelector("#metinput").value="";
	  } else {
	    x.innerHTML = "<i class='fas fa-times'></i> Remove Description";
	    descbutton.closest(".methodclass").querySelector("#metinput").value="";
	    //x.style.cssText  = "border-color: #c21919; color:#c21919;";
	  }
	}

	function videobtnchange(addvideobutton) {
	 /* var x = document.getElementById("addvideo");

	  if (x.innerHTML.includes("Remove")) { //includes check if it's add or remove
	    x.innerHTML = "<i class='fab fa-youtube'></i> Add Video";
		//x.style.cssText  = "border-color: #0275d8;";
		document.getElementById("noteinput").value = "";
	  } else {
	    x.innerHTML = "<i class='fab fa-youtube'></i> Remove Video";
	    document.getElementById("input").value = "";
	    //x.style.cssText  = "border-color: #c21919; color:#c21919;";
	  }*/
	}

	function searchvideourl(){
		//var videospot = document.getElementsByClassName("videocanvas");
		var urlinput = document.getElementById("videourlinput").value;
		
		
		var embedurl = urlinput.replace("watch?v=", "embed/");
		alert(embedurl);
		var videospot = document.getElementById('videocanvas');
  		videospot.innerHTML = '<iframe height="200px" width="auto" src="'+ embedurl + '" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen SameSite="None"></iframe>';
	}

	function stepadd(addbutton) {
	  
	    //let parentdiv = theaddbutton.parentNode.parentNode.parentNode.parentNode.parentNode;

	    var thismethod = addbutton.closest(".methodbox");

	    let menu = thismethod.querySelector('.stepclass');
        let clonedMenu = menu.cloneNode(true);

	    var numofsteps = thismethod.querySelectorAll(".stepclass");
	    var maximumstepcount = parseInt(numofsteps.length, 10)

		//clonedMenu.id = 'stepblock' + (maximumstepcount+1);

        thismethod.querySelector(".forsteps").appendChild(clonedMenu);

        //change step number in each repetition
        var changestepnumber = clonedMenu.getElementsByClassName("stepcircle")[0];
        changestepnumber.innerHTML = (maximumstepcount+1);

        //change step number inside box
        var changestepnum = clonedMenu.getElementsByClassName("titlelabel")[0];
        changestepnum.innerHTML = "Step " + (maximumstepcount+1);

        //remove any existing texts
        var refreshtext = clonedMenu.getElementsByClassName("inputboxes")[0];
        refreshtext.value = "";

        //remove any existing texts
        var refreshtext = clonedMenu.getElementsByClassName("inputboxes")[0];
        refreshtext.value = "";

        //enable removestepbutton state as active
        var removestepbtn = clonedMenu.getElementsByClassName("removestepbtn")[0];
        removestepbtn.disabled = false;
        removestepbtn.id = "removebuttonid" + (maximumstepcount+1);

	}

	function removestep(removebutton) {  //id is for which step number is selected to remove
		
		var thismethod = removebutton.closest(".methodbox"); //for stepfixer

		var thisstep = removebutton.closest(".stepclass");
		//var num = removebutton.replace(/\D/g, "");
thisstep.parentNode.removeChild(thisstep);
		stepfixer(thismethod);

	}

	function stepfixer(forsteps){

		var numofsteps = forsteps.querySelectorAll(".stepclass");
	    var maximumstepcount = parseInt(numofsteps.length, 10)
		

	    for (j=1; j < maximumstepcount; j++) {

	    	//Fixing the step display number
	    	var newelement = numofsteps[j].getElementsByClassName("stepcircle")[0];
            newelement.innerHTML = j+1;

	    	//Fixing the remove button id 
            var changebuttonid = numofsteps[j].querySelector(".removestepbtn");
          	changebuttonid.id = "removebuttonid" + (j+1);

	    	//Fixing the step number inside input
          	var changeinnerstep = numofsteps[j].querySelector(".titlelabel");
          	changeinnerstep.innerHTML = "Step " + (j+1);
	    	//alert("numofsteps[j].id")
		}
	}
	
	function noteadd(thenotebutton) {

		var thismethod = thenotebutton.closest(".methodbox");
	  	let menu = thismethod.querySelector('#notebox');
        let clonedMenu = menu.cloneNode(true);
        clonedMenu.hidden = false;

        thismethod.querySelector(".forsteps").appendChild(clonedMenu);
	}

	function removenote(thenotebutton) {  

		var thisnote = thenotebutton.closest(".noteclass");
		//var num = removebutton.replace(/\D/g, "");

		thisnote.parentNode.removeChild(thisnote);
	}


	function getfinalstring(){
		/*var alltext = document.getElementById('forsteps').getElementsByTagName('inpt')[0];

		alert(alltext.innerHTML);*/

		var divElem = document.getElementById("forsteps");
		var inputElements = divElem.querySelectorAll("textarea, input"); //gets all type of ELEMENTS precised in ORDER so great!!!!
		var temparray = [];

		var number = parseInt(inputElements.length, 10);

		var finalstring = "";

		var methodname = document.getElementsByClassName("methodname");
		finalstring = finalstring + "@m@meth " + methodname[0].value + "\n";

		var methoddesc = document.getElementsByClassName("methoddescinput");
		if(methoddesc[0].value != ""){
			finalstring = finalstring + "@s@desc " +  methoddesc[0].value + "@s@\n";
		}

		for (i=0; i < number; i++){
			if(inputElements[i].id == "step"){
				temparray[i] = "@s@step " + inputElements[i].value + " @s@ \n";
			}

			if(inputElements[i].id == "noteinput"){
				temparray[i] = "@s@note " + inputElements[i].value + " @s@ \n";
			}
		}


		for(var sentence in temparray){
			finalstring = finalstring + temparray[sentence];
		}
		alert(finalstring);
		
	}


	function methodadd() {
	  let menu = document.querySelector('#methodblock');
        let clonedMenu = menu.cloneNode(true);

        clonedMenu.hidden = false;

        var numofsteps = document.querySelectorAll(".methodclass");
	    var maximummethodcount = parseInt(numofsteps.length, 10);

	    clonedMenu.id = 'methodblock' + (maximummethodcount+1);
        document.getElementById("formethod").appendChild(clonedMenu);

        clonedMenu.querySelector("#methoddescbox").id = "methoddescbox" + (maximummethodcount+1);
	}


	function loadmethod() {
        let menu = document.querySelector('#methodblock');
        let clonedMenu = menu.cloneNode(true);
        clonedMenu.hidden = false;

        var addstepbutton = clonedMenu.querySelector("#addstepbtn0")
        addstepbutton.id = "addstepbutton1"

	    clonedMenu.id = 'methodblock1';
        document.getElementById("formethod").appendChild(clonedMenu);
        }

    window.onload = loadmethod;
	 
</script>


<nav class="navbar navbar-expand-lg fixed-top">

	<button class="navbar-toggler navbar-dark  " type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon "></span>
  </button>

  <img class="navbar-brand" src="Images/Logo/logo.png" href="#"></img>

	<button type="button" class="btn navbuttons d-none d-md-block" data-toggle="collapse" href="#navbarSupportedContent">Home</button>

	<button type="button" class="btn navbuttons d-none d-md-block" data-toggle="collapse" href="#navbarSupportedContent">Fixes</button>

	<form class="form-inline searcharea d-flex justify-content-center ">
      <input class="form-control d-none d-md-block searchbar" type="search" placeholder="Search for a fix!" aria-label="Search">
  </form>

  <div class="collapse navbar-collapse text-center  identificationtab" id="navbarSupportedContent">
    <ul class="navbar-nav">
    
      <li class="nav-item pr-2">
        <a class="nav-link navbuttons " href="#"><i class="far fa-plus-square navbuttons"></i> Upload Post</span></a>
      </li>
      <li class="nav-item pr-2">
        <button type="button" class="btn btn-light signin"><i class="fas fa-sign-in-alt"></i> Sign In</button>
      </li>
    </ul>
  </div>
</nav>


<div class="container-fluid">
      <div class="row">
        <nav class="col-md-2 d-none d-md-block sidebar">
          <div class="sidebar position-fixed">

            <h6 class="sidebar-heading d-flex text-muted sidebarcontent">
              <span>Recently added <i class="fas fa-history"></i></span>
            </h6>

            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link" href="#">
                  Fix number 1
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="#">
                  Fix number 2
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  Fix number 3
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="#">
                  Fix number 4
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <main role="main" class="col-md-8">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          	<div class="">
            	<h1 class="h2 posttitle">Create New Post</h1>
			</div>
			<div class="btn-toolbar pull-right ">
              <button onclick="getfinalstring()" class="btn btn-sm btn-primary secondarycolor">Upload</button>
            </div>
          </div>

          <form>
			    <div class="row">
			        <div id="leftNav" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			            <div class="form-group" id="holder"> 
			            	<small id="titlelabel" class="titlelabel" for="input">Post Title</small>
			                <input type="email" class="form-control inputboxes" id="input" placeholder="Something short and precise">
			            </div>

			        </div>
			    </div>

			    <div class="row">
			        <div id="leftNav" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			            <div class="form-group"> 
			            	<small id="titlelabel" class="titlelabel" for="input">Post Description</small>
			                <textarea type="email" class="form-control inputboxes" id="input" placeholder="A brief description of the error and how you're going to solve it!" rows="2"></textarea>
			            </div>
			        </div>
			    </div>
			</form>

		<div id="formethod">
          	<div class="container pt-3 methodclass" id="methodblock" hidden>
          		<div class="row s methodrow">
          			<div class="container d-none d-lg-block s col-md-1"><div class="methodcircle"><i class="fas fa-wrench"></i></div>
          		</div>

          		<input class="form-control methodname s col-md-7" placeholder="A small name for this method">

          		<div class="container col-md-4 s pull-right align-items-center">
          			<button class="arrowbtn s border-top border-bottom col-md-1" data-toggle="collapse" href="#collapseExample" id="arrowbtn" role="button"><i class="fas fa-angle-up js-rotate-if-collapsed"></i></button>
          			<button onclick="descbuttonchange(this)" type="button" data-toggle="collapse" href="#methoddescbox" role="button" aria-expanded="false" aria-controls="methoddescbox" class="btn btn-outline-primary adddescbtn mt-2 ml-md-5" id="adddesc" role="button"><i class='fas fa-plus'></i> Add description</button>
          		</div>
				
				
          	</div>

          	<div class="collapse pt-2 row methodbox show" id="collapseExample">
			  	<div class="card card-body col-md-12">
			  		<div class="show methoddesccont pull-right" >
			  			<div class="collapse row" id="methoddescbox">
			        		<div id="leftNav" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			            		<div class="form-group" id="holder"> 
			            			<small id="titlelabel" class="titlelabel" for="input">Method Description</small>
			                		<input type="email" class="form-control inputboxes methoddescinput" id="metinput">
			            		</div>
			        		</div>
			    		</div>
			  		
			  		</div>
			    
			  		<div class="forsteps" id="forsteps" tag="forsteps">
			   		   	<div class="d-flex flex-row pt-3 stepclass" id="stepclass" >
	          			  	 <div class="d-none d-md-block">
	          			   		<div class="stepcircle">1</div>
	          			   	 </div>
          		
							<div class="container">
						        <div class="form-group" id=""> 
						            <small id="titlelabel" class="titlelabel" for="input">Step 1</small>

						            <button onclick="removestep(this)" id="removebuttonid" type="button" class="btn btn-outline-secondary addstepimgbtn removestepbtn" role="button"  disabled><i class="fas fa-times-circle"></i></button>

						            <textarea type="text" class="form-control inputboxes stepbox " tag="step" id="step" placeholder="Here you can give a detailed explanation for this step, use bold if necessary." rows="2"></textarea>
								</div>

						<!--<button class="fontStyle boldtextbtn" onclick="document.execCommand( 'bold',false,null);" title="Bold Highlighted Text"><b>B</b>
    </button> -->
						
							</div>

				  		</div>
				
          			</div>

          			<div class="row noteclass pt-3" id="notebox" hidden="false">
							        <div id="leftNav" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
							            <div class="form-group"> 
							            	<small id="titlelabel" class="titlelabel" for="input">Note: </small>

							            	<button onclick="removenote(this)" id="removebuttonid" type="button" class="btn btn-outline-secondary addstepimgbtn removenotebtn" role="button"><i class="fas fa-times-circle"></i></button>

							                <textarea type="email" class="form-control noteinput" id="noteinput"></textarea> 


							            </div>
							        </div>
						  		</div>

          		<div class="pt-2 show methoddesccont pull-right" >
			  		

				  	<div class="collapse" id="videochoose">
				  		<div>
				  			<div class="form-group" id="holder"> 
			            	<small id="titlelabel" class="titlelabel" for="input">Add Video Url</small>
			                <input onchange="searchvideourl()" type="email" class="form-control inputboxes" id="videourlinput" placeholder="Copy and paste the video url here">
			            </div>
				  		</div>
				  		<div class="container">
							<div id="videocanvas" class='videocanvas' onclick='changehtml()'>
							  </div>
						</div>
			    	</div>

				<div class="row">
					<button onclick="stepadd(this)" type="button" class="btn col-md-5 mt-2 mx-auto stepfinalbuttons secondarycolor" role="button" id="addstepbtn0"><i class="fas fa-plus-circle"></i> Add Step</button>

					<button onclick="noteadd(this)" type="button" class="btn btn-warning mt-2 mx-auto stepfinalbuttons col-md-2" href="#notebox" role="button" id="addnote"><i class="fas fa-exclamation-triangle"></i> Add Note</button>

					<button type="button" class="btn btn-primary addstepimgbtn mx-auto mt-2 col-md-2" role="button"><i class="fas fa-image"></i>  Add Image</button>

					<button onclick="videobtnchange(this)" data-toggle="collapse" href="#videochoose" type="button" class="btn btn-danger mt-2 mx-auto stepfinalbuttons col-md-2" role="button" id="addvideo"><i class="fab fa-youtube"></i> Add Video</button>
					
				</div>
          		</div>
          	</div>
          </div>
		  </div>
		</div>

		  <div class="d-flex flex-row pt-4">
		  	<button onclick="methodadd()" type="button" class="btn btn-dark mx-auto stepfinalbuttons justify-content-end"><i class="fas fa-plus-circle"></i> Add New Method</button>
		  </div>
		

        </main>

		<div class="container col-md-2 pt-4">
			<canvas class="myCanvas col-12 adcanvas "></canvas>
		</div>

      </div>
    </div>


<header class="page-header header container-fluid">
</header>

</body>
</html>
